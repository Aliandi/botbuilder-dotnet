# LuisDispatchBot hosted in ASP.NET Core

This bot demonstrates how to use a LUIS app generated by the Dispatch tool. 

See https://aka.ms/bot-dispatch for more information on the Dispatch tool.

??? Describe how to create a QnA Maker and LUIS subscription ???

In order to run the sample you will need to:
1) ??? Make sure node.js and npm are on your machine.???
2) cd scripts && setup
3) Answer setup questions

At the end of this process you will have:
1) 2 LUIS models: weather, homeautomation
2) A QnA Maker kb: faq
3) 

create a QnA database.

To build your dispatch model:
    dispatch 

    C:\Users\chrimc\Documents\Bots>dispatch init
Please enter required field(s) below.

What name would you like for your dispatch:
dispatchSample
What's your LUIS authoring key (from https://www.luis.ai/user/settings):
0f43266ab91447ec8d705897381478c5
What's your LUIS authoring region [westus, westeurope, australiaeast]:
westus
dispatchSample.dispatch created

C:\Users\chrimc\source\repos\botbuilder-dotnet\samples-final\AspNetCore-Luis-Dispatch-Bot>dispatch add -type luis -id 01f706cc-9981-451f-ba79-d90d94feb0ba -name weather -version 0.1 -key 0f43266ab91447ec8d705897381478c5
LUIS app id:01f706cc-9981-451f-ba79-d90d94feb0ba, name:weather, authoring key:0f43266ab91447ec8d705897381478c5, version:0.1 added to dispatchSample.dispatch

C:\Users\chrimc\source\repos\botbuilder-dotnet\samples-final\AspNetCore-Luis-Dispatch-Bot>dispatch add -type luis -key 0f43266ab91447ec8d705897381478c5 -id 09d165f2-7ca3-4ec3-ac36-20cf70a398c4 -name homeautomation -version 0.1
LUIS app id:09d165f2-7ca3-4ec3-ac36-20cf70a398c4, name:homeautomation, authoring key:0f43266ab91447ec8d705897381478c5, version:0.1 added to dispatchSample.dispatch

C:\Users\chrimc\source\repos\botbuilder-dotnet\samples-final\AspNetCore-Luis-Dispatch-Bot>dispatch create -dispatch dispatchSample.dispatch
Exporting services for dispatch...
Exporting weather LUIS application...
Exporting homeautomation LUIS application...
Creating dispatch LUIS model json...
Creating training data...
Updating dispatchSample model...
Importing dispatchSample model...
Training dispatchSample model...
Publishing dispatchSample model...
Writing summary file...
{
  "authoringRegion": "westus",
  "hierarchical": true,
  "services": [
    {
      "appId": "01f706cc-9981-451f-ba79-d90d94feb0ba",
      "authoringKey": "0f43266ab91447ec8d705897381478c5",
      "version": "0.1",
      "type": "luis",
      "name": "weather",
      "id": "01f706cc-9981-451f-ba79-d90d94feb0ba"
    },
    {
      "appId": "09d165f2-7ca3-4ec3-ac36-20cf70a398c4",
      "authoringKey": "0f43266ab91447ec8d705897381478c5",
      "version": "0.1",
      "type": "luis",
      "name": "homeautomation",
      "id": "09d165f2-7ca3-4ec3-ac36-20cf70a398c4"
    }
  ],
  "appId": "92dec140-0deb-40e8-921a-128751ccdd4e",
  "authoringKey": "0f43266ab91447ec8d705897381478c5",
  "version": "Dispatch",
  "type": "dispatch",
  "name": "dispatchSample",
  "id": "92dec140-0deb-40e8-921a-128751ccdd4e"
}
Please review your dispatch model in Summary.html

This example assumes the LUIS app from Dispatch is generated from two LUIS apps and one QnAMaker service:
 * A LUIS app named "homeautomation", for handling messages about turning lights and appliances on and off
 * A LUIS app named "weather", for handling requests for weather forecasts and conditions
 * A QnA Maker service named "faq", for answering questions about using the hypothetical home automation system.
 
First create the LUIS apps and QnAMaker, then generate a LUIS app from them using the Dispatch tool.

1. Use the https://luis.ai portal to import the included homeautomation.json and weather.json model files or using [LUIS cli tool](https://github.com/Microsoft/botbuilder-tools/tree/master/LUIS).
2. Use the https://qnamaker.ai portal to import the included sampleKnowledgeBase.tsv faq file or using [QnAMaker cli tool](https://github.com/Microsoft/botbuilder-tools/tree/master/QnAMaker).
3. Train and Publish your apps bfore using the Dispatch tool. (For your convenience the resulting dispatchSample.json LUIS model is also included).

The tool creates a LUIS app with one intent for each of the constituent LUIS apps and QnAMaker services: 
"l_homeautomation", "l_weather", "q_faq".
The bot uses the intents to route the user messages to the appropriate LUIS app or QnA Maker.

Dispatching the messages to the original LUIS apps allows the bot to get entities from the these apps. 
The LUIS app generated by the Dispatch tool doesn't contain entity information.

To use the sample, update Startup.cs with the LUIS App ID and Subscription Key for the LUIS app that the Dispatch tool generates. 
Update the subscription keys and app IDs in LuisDispatchBot.cs with the ones for the constituent LUIS apps and QnAMaker service. 
